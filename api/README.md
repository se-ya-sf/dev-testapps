# WBS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API

NestJS + Prisma ã§æ§‹ç¯‰ã•ã‚ŒãŸRESTful APIã§ã™ã€‚

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: NestJS
- **è¨€èª**: TypeScript
- **ORM**: Prisma
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLiteï¼ˆé–‹ç™ºï¼‰/ Azure SQLï¼ˆæœ¬ç•ªï¼‰
- **èªè¨¼**: JWT + Microsoft Entra ID
- **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: Swagger (OpenAPI)

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
api/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma     # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”œâ”€â”€ seed.ts           # ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ dev.db            # SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆé–‹ç™ºï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ app.module.ts     # ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ prisma/           # Prismaã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ auth/             # èªè¨¼ãƒ»èªå¯
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ guards/       # JWT/Rolesã‚¬ãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ dto/          # ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ projects/         # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
â”‚   â”œâ”€â”€ tasks/            # ã‚¿ã‚¹ã‚¯ï¼ˆWBSï¼‰ç®¡ç†
â”‚   â”œâ”€â”€ dependencies/     # ä¾å­˜é–¢ä¿‚ç®¡ç†
â”‚   â”œâ”€â”€ baselines/        # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ timelogs/         # å·¥æ•°ãƒ­ã‚°
â”‚   â”œâ”€â”€ comments/         # ã‚³ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ deliverables/     # æˆæœç‰©
â”‚   â”œâ”€â”€ teams/            # Teamsé€£æº
â”‚   â”œâ”€â”€ export/           # Excelå‡ºåŠ›
â”‚   â””â”€â”€ changelog/        # å¤‰æ›´å±¥æ­´
â””â”€â”€ package.json
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ç’°å¢ƒå¤‰æ•°

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```env
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
DATABASE_URL="file:./dev.db"

# JWT
JWT_SECRET="your-secret-key"

# èªè¨¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆmock ã¾ãŸã¯ entraï¼‰
AUTH_MODE="mock"

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰URLï¼ˆCORSç”¨ï¼‰
WEB_URL="http://localhost:3000"

# ãƒãƒ¼ãƒˆ
PORT=4000

# ç’°å¢ƒ
NODE_ENV="development"

# Entra IDï¼ˆæœ¬ç•ªç”¨ï¼‰
# ENTRA_TENANT_ID="your-tenant-id"
# ENTRA_CLIENT_ID="your-client-id"
# ENTRA_CLIENT_SECRET="your-client-secret"
```

### ã‚³ãƒãƒ³ãƒ‰

```bash
# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# Prisma Clientã®ç”Ÿæˆ
npm run db:generate

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®åæ˜ 
npm run db:push

# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
npm run db:seed

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
npm run start:dev

# æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build

# æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
npm run start:prod
```

## ğŸ“¡ APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### èªè¨¼

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| GET | `/api/me` | ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | å¿…é ˆ |
| POST | `/api/auth/dev-login` | é–‹ç™ºç”¨ãƒ­ã‚°ã‚¤ãƒ³ | ä¸è¦ |

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å¿…è¦ãƒ­ãƒ¼ãƒ« |
|---------|------|------|-----------|
| GET | `/api/projects` | ä¸€è¦§å–å¾— | - |
| POST | `/api/projects` | æ–°è¦ä½œæˆ | - |
| GET | `/api/projects/:id` | è©³ç´°å–å¾— | Viewerä»¥ä¸Š |
| PATCH | `/api/projects/:id` | æ›´æ–° | PMä»¥ä¸Š |

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å¿…è¦ãƒ­ãƒ¼ãƒ« |
|---------|------|------|-----------|
| GET | `/api/projects/:id/members` | ä¸€è¦§å–å¾— | Viewerä»¥ä¸Š |
| POST | `/api/projects/:id/members` | è¿½åŠ  | PMä»¥ä¸Š |
| PATCH | `/api/projects/:id/members/:userId` | ãƒ­ãƒ¼ãƒ«å¤‰æ›´ | PMä»¥ä¸Š |

### ã‚¿ã‚¹ã‚¯ï¼ˆWBSï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å¿…è¦ãƒ­ãƒ¼ãƒ« |
|---------|------|------|-----------|
| GET | `/api/projects/:id/tasks` | ä¸€è¦§å–å¾— | Viewerä»¥ä¸Š |
| POST | `/api/projects/:id/tasks` | æ–°è¦ä½œæˆ | Contributorä»¥ä¸Š |
| GET | `/api/tasks/:id` | è©³ç´°å–å¾— | Viewerä»¥ä¸Š |
| PATCH | `/api/tasks/:id` | æ›´æ–° | Contributorä»¥ä¸Š |
| DELETE | `/api/tasks/:id` | å‰Šé™¤ | Managerä»¥ä¸Š |
| POST | `/api/tasks/:id/move` | ç§»å‹• | Contributorä»¥ä¸Š |

### ä¾å­˜é–¢ä¿‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | å¿…è¦ãƒ­ãƒ¼ãƒ« |
|---------|------|------|-----------|
| GET | `/api/projects/:id/dependencies` | ä¸€è¦§å–å¾— | Viewerä»¥ä¸Š |
| POST | `/api/projects/:id/dependencies` | æ–°è¦ä½œæˆ | Managerä»¥ä¸Š |
| DELETE | `/api/dependencies/:id` | å‰Šé™¤ | Managerä»¥ä¸Š |

## ğŸ” èªå¯ï¼ˆRBACï¼‰

### ãƒ­ãƒ¼ãƒ«éšå±¤

```
Admin > PM > Manager > Contributor > Viewer
```

### ãƒ­ãƒ¼ãƒ«åˆ¥æ¨©é™

| æ“ä½œ | Admin | PM | Manager | Contributor | Viewer |
|-----|-------|-----|---------|-------------|--------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–° | âœ… | âœ… | âŒ | âŒ | âŒ |
| ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç† | âœ… | âœ… | âŒ | âŒ | âŒ |
| ã‚¿ã‚¹ã‚¯ä½œæˆ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ã‚¿ã‚¹ã‚¯æ›´æ–° | âœ… | âœ… | âœ… | âœ… | âŒ |
| ã‚¿ã‚¹ã‚¯å‰Šé™¤ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¾å­˜é–¢ä¿‚ç®¡ç† | âœ… | âœ… | âœ… | âŒ | âŒ |
| é–²è¦§ | âœ… | âœ… | âœ… | âœ… | âœ… |

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

- **User** - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆEntra ID OIDï¼‰
- **Project** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **ProjectMember** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼ˆå¤šå¯¾å¤šï¼‰
- **Task** - ã‚¿ã‚¹ã‚¯ï¼ˆè‡ªå·±å‚ç…§ã§éšå±¤æ§‹é€ ï¼‰
- **TaskAssignee** - ã‚¿ã‚¹ã‚¯æ‹…å½“è€…
- **Dependency** - ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚
- **TimeLog** - å·¥æ•°ãƒ­ã‚°
- **Baseline** - ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
- **BaselineTask** - ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ™‚ç‚¹ã®ã‚¿ã‚¹ã‚¯
- **Comment** - ã‚³ãƒ¡ãƒ³ãƒˆ
- **ChangeLog** - å¤‰æ›´å±¥æ­´
- **Deliverable** - æˆæœç‰©
- **TaskDeliverable** - ã‚¿ã‚¹ã‚¯ã¨æˆæœç‰©ã®ç´ä»˜ã‘
- **TeamsSetting** - Teamsè¨­å®š
- **IntegrationLog** - é€£æºãƒ­ã‚°

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
npm run test

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test:cov
```

## ğŸ“ é–‹ç™ºæ™‚ã®Tips

### Prisma Studioï¼ˆDBãƒ–ãƒ©ã‚¦ã‚¶ï¼‰
```bash
npx prisma studio
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆ
```bash
rm prisma/dev.db
npm run db:push
npm run db:seed
```

### Swagger UIã§APIãƒ†ã‚¹ãƒˆ
http://localhost:4000/api/docs ã«ã‚¢ã‚¯ã‚»ã‚¹
